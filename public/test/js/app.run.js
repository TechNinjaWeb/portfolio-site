angular.module('tnApp').run(function($rootScope,$window,$timeout){var userAgent;if(window.navigator.userAgent.indexOf('Safari')!=-1&&window.navigator.userAgent.indexOf('Chrome')==-1){userAgent="safari";}else if(window.navigator.userAgent.indexOf('Firefox')!=-1&&window.navigator.userAgent.indexOf('Safari')==-1){userAgent="firefox";}else if(window.navigator.userAgent.indexOf('Chrome')!=-1&&window.navigator.userAgent.indexOf('Firefox')==-1){userAgent="chrome";}else{userAgent="unknown";}var browser=userAgent;$rootScope.browser=browser;$rootScope.userAgent=userAgent;Parse.initialize("XFukCIc6giByefQZjvKjvRQdyaID0OqseAdLYGE4","TfVbMHnjFPVGfUIFCVCeVr3SWgrgEr5uoxrBSSvz");$rootScope.createRoles=function(){var accountRole=new Parse.ACL();accountRole.setPublicReadAccess(true);accountRole.setRoleWriteAccess("Admin",true);var userRole=new Parse.Role("User",accountRole);var adminRole=new Parse.Role("Admin",accountRole);var RoleObject=Parse.Object.extend('_Role');var userRoleQuery=new Parse.Query(RoleObject);var adminRoleQuery=new Parse.Query(RoleObject);var queryRoleObject=new Parse.Query.or(userRoleQuery,adminRoleQuery);userRoleQuery.equalTo("name","User");adminRoleQuery.equalTo("name","Admin");var saveUsers={user:function(){userRole.save(null,{success:function(userRole){},error:function(userRole,err){var userRoleString=JSON.stringify(userRole,null,4);}}).then(function(userRole,err){});},admin:function(){adminRole.save(null,{success:function(adminRole){},error:function(adminRole,err){var adminRoleString=JSON.stringify(adminRole,null,4);}});}};queryRoleObject.find({success:function(results){var user=false;var admin=false;for(var i=0;i<results.length;i++){var object=results[i];var name=object.get('name');var id=object.id;var date=object.updatedAt;if(name==="Admin"){admin=true;}else if(name==="User"){user=true;}}if(results.length==0){saveUsers.user();saveUsers.admin();}else if(results.length!=0&&results.length<=1){if(!admin){saveUsers.admin();}else if(!user){saveUsers.user();}}else{}},error:function(error){alert("Error: "+error.code+" "+error.message);}});};$rootScope.checkAdmin=function(){var techNinjaAdminID="587154828096319";var query=new Parse.Query($rootScope.Users);query.equalTo("email","phreelyfe@gmail.com");if($rootScope.sessionUserName==="Phree Lyfe"){query.find({success:function(results){for(var i=0;i<results.length;i++){var object=results[i];var fbAuthDataString=JSON.stringify(object.get('authData'));var fbAuthDataObject=JSON.parse(fbAuthDataString);if(fbAuthDataObject.facebook.id===techNinjaAdminID){}else if(fbAuthDataObject.facebook.id===null||fbAuthDataObject.facebook.id===""){}else{}}},error:function(error){alert("Error: "+error.code+" "+error.message);}});}else{}};$rootScope.reloadWindow=function(){$timeout(function(){$window.location.reload();},200);};$rootScope.collectFacebookData=function(user){FB.api('/me',function(response){var object=response;user.set("username",object.name);user.set("firstName",object.first_name);user.set("lastName",object.last_name);user.set("email",object.email);user.save();});FB.api('/me/picture',{"type":"normal"},function(response){var object=response;user.set("profilePic",object.data.url);user.save();});};var User=Parse.User.extend({});$rootScope.ParseUser=User;$rootScope.sessionUser=Parse.User.current();if($rootScope.sessionUser){$rootScope.sessionUserName=Parse.User.current().get('username');$rootScope.createRoles();}if($rootScope.sessionUser){$rootScope.currentUsername=Parse.User.current().get('username');$rootScope.sessionUserId=$rootScope.sessionUser.id;}if($rootScope.currentUsername=="Phree Lyfe"){$rootScope.techNinjaAdminName=$rootScope.currentUsername;$rootScope.techNinjaAdmin=true;}else{$rootScope.techNinjaAdmin=false;}var ParseUserClass=Parse.Object.extend("User");var ParsePostClass=Parse.Object.extend("Post");var ParseCommentClass=Parse.Object.extend("Comment");var ParseRoleObject=Parse.Object.extend('_Role');});